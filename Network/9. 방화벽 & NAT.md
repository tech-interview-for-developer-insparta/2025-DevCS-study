# 방화벽 & NAT

## 방화벽 (Firewall)

### 개념
방화벽은 네트워크 보안의 첫 번째 방어선으로, 미리 정의된 보안 규칙에 따라 들어오고 나가는 네트워크 트래픽을 모니터링하고 제어하는 시스템입니다. 마치 건물의 경비원처럼, 허가된 트래픽만 통과시키고 의심스러운 접근은 차단합니다.

### 동작 원리
방화벽은 패킷의 헤더 정보(출발지/목적지 IP, 포트 번호, 프로토콜 등)를 검사하여 허용 또는 차단 여부를 결정합니다.

### 방화벽의 종류

#### 1. 패킷 필터링 방화벽 (Packet Filtering Firewall)
- OSI 3계층(네트워크 계층)에서 동작
- IP 주소, 포트 번호, 프로토콜을 기반으로 패킷을 필터링
- 빠르지만 상태 정보를 추적하지 못하는 한계

```
예시 규칙:
- 허용: 출발지 192.168.1.0/24, 목적지 포트 80 (HTTP)
- 차단: 출발지 *, 목적지 포트 23 (Telnet)
```

#### 2. 상태 기반 방화벽 (Stateful Firewall)
- 연결 상태를 추적하여 더 지능적으로 판단
- TCP 3-way handshake와 같은 연결 상태를 기억
- 현재 가장 널리 사용되는 방식

#### 3. 애플리케이션 계층 방화벽 (Application Layer Firewall)
- OSI 7계층에서 동작
- HTTP, FTP, DNS 등 특정 애플리케이션 프로토콜을 심층 분석
- 웹 애플리케이션 방화벽(WAF)이 대표적

#### 4. 차세대 방화벽 (NGFW - Next Generation Firewall)
- 전통적인 방화벽 기능에 IPS, 악성코드 탐지, 애플리케이션 인식 등을 통합
- 더 정교한 위협 탐지와 차단 가능

### 방화벽 정책
```
기본 정책:
1. Whitelist 방식: 모든 것을 차단하고 필요한 것만 허용 (권장)
2. Blacklist 방식: 모든 것을 허용하고 위험한 것만 차단
```

---

## NAT (Network Address Translation)

### 개념
NAT는 IP 패킷의 출발지 또는 목적지 IP 주소를 변환하는 기술입니다. 주로 사설 IP 주소를 공인 IP 주소로 변환하여, 제한된 공인 IP 자원을 효율적으로 활용하고 내부 네트워크를 보호합니다.

### NAT가 필요한 이유

#### 1. IPv4 주소 고갈 문제 해결
전 세계적으로 약 43억 개의 IPv4 주소만 존재하지만, 인터넷에 연결되는 기기는 이를 훨씬 초과합니다. NAT를 통해 하나의 공인 IP로 여러 사설 IP 기기를 인터넷에 연결할 수 있습니다.

#### 2. 보안 강화
외부에서 내부 네트워크의 실제 IP 구조를 알 수 없어, 자연스러운 보안 계층이 형성됩니다.

### 사설 IP 주소 대역
```
Class A: 10.0.0.0 ~ 10.255.255.255
Class B: 172.16.0.0 ~ 172.31.255.255
Class C: 192.168.0.0 ~ 192.168.255.255
```

### NAT의 종류

#### 1. Static NAT (정적 NAT)
- 하나의 사설 IP를 하나의 공인 IP로 1:1 매핑
- 내부 서버를 외부에 공개할 때 사용
```
사설 IP          공인 IP
192.168.1.10  →  203.0.113.10
192.168.1.11  →  203.0.113.11
```

#### 2. Dynamic NAT (동적 NAT)
- 사설 IP를 공인 IP 풀에서 동적으로 할당
- 공인 IP 개수만큼만 동시 연결 가능

#### 3. PAT (Port Address Translation) / NAT Overload
- **가장 일반적으로 사용되는 방식**
- 하나의 공인 IP로 여러 사설 IP를 포트 번호로 구분하여 변환
- 가정용 공유기가 사용하는 방식

```
내부 네트워크              NAT 라우터                   인터넷
192.168.1.10:3000   →   203.0.113.1:50001   →   목적지 서버
192.168.1.11:3000   →   203.0.113.1:50002   →   목적지 서버
192.168.1.12:4000   →   203.0.113.1:50003   →   목적지 서버
```

### NAT 변환 테이블
NAT 장비는 내부 주소와 외부 주소의 매핑 정보를 테이블로 관리합니다.

```
| 내부 IP:Port      | 외부 IP:Port      | 목적지 IP:Port         |
|-------------------|-------------------|------------------------|
| 192.168.1.10:3000 | 203.0.113.1:50001 | 8.8.8.8:80            |
| 192.168.1.11:3000 | 203.0.113.1:50002 | 142.250.185.46:443    |
```

### NAT의 동작 과정 (PAT 예시)

1. **내부 → 외부 (Outbound)**
   - 내부 호스트(192.168.1.10:3000)가 외부 서버(8.8.8.8:80)에 요청
   - NAT 장비가 출발지 주소를 공인 IP로 변환 (203.0.113.1:50001)
   - 변환 정보를 NAT 테이블에 저장
   - 변환된 패킷을 외부로 전송

2. **외부 → 내부 (Inbound)**
   - 외부 서버의 응답이 공인 IP(203.0.113.1:50001)로 도착
   - NAT 장비가 테이블을 확인하여 내부 주소(192.168.1.10:3000)로 변환
   - 변환된 패킷을 내부 호스트로 전달

### NAT의 장단점

#### 장점
- IPv4 주소 절약
- 내부 네트워크 구조 은닉으로 보안 향상
- 내부 IP 주소 체계를 자유롭게 변경 가능

#### 단점
- 엔드 투 엔드(End-to-End) 연결성 위반
- P2P 통신 어려움 (NAT Traversal 기술 필요)
- 추가적인 지연 시간 발생
- 일부 프로토콜에서 문제 발생 가능 (FTP, SIP 등)

### 포트 포워딩 (Port Forwarding)
외부에서 내부 서버로 접속하기 위한 NAT 설정 방법입니다.

```
외부 요청: 203.0.113.1:8080
    ↓
NAT 규칙: 8080 → 192.168.1.100:80
    ↓
내부 웹 서버: 192.168.1.100:80
```

---

## 방화벽과 NAT의 관계

현대 네트워크에서 방화벽과 NAT는 종종 함께 동작합니다:

- **가정용 공유기**: NAT와 기본적인 방화벽 기능을 모두 제공
- **기업 환경**: 별도의 방화벽과 NAT 장비를 구성하거나 통합 장비 사용
- **클라우드 환경**: Security Group(방화벽)과 NAT Gateway를 조합하여 사용

두 기술 모두 네트워크 보안과 효율성을 위해 필수적인 요소이며, 서로 보완적인 역할을 수행합니다.
