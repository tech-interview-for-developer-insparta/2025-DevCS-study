# 프록시 & 리버스 프록시

## 프록시 (Forward Proxy)

### 개념
프록시는 클라이언트와 서버 사이에서 중개자 역할을 하는 서버입니다. 클라이언트가 다른 서버로 요청을 보낼 때, 직접 연결하는 대신 프록시 서버를 거쳐서 요청을 전달합니다. 마치 대리인을 통해 업무를 처리하는 것과 같습니다.

### 동작 구조
```
클라이언트 → 프록시 서버 → 목적지 서버
    ↑                           ↓
    ←────────────────────────────
           응답 경로
```

### 상세 동작 과정
1. 클라이언트가 프록시 서버에 요청 전송 (예: google.com 접속 요청)
2. 프록시 서버가 클라이언트를 대신하여 google.com에 요청
3. Google 서버는 프록시 서버의 IP를 클라이언트로 인식
4. 프록시 서버가 응답을 받아 클라이언트에게 전달

### 프록시의 주요 기능

#### 1. 익명성 보장
클라이언트의 실제 IP 주소를 숨기고 프록시 서버의 IP로 대체합니다.
```
실제 IP: 192.168.1.10 (숨겨짐)
표시 IP: 프록시 서버 IP (203.0.113.50)
```

#### 2. 캐싱 (Caching)
자주 요청되는 콘텐츠를 프록시 서버에 저장하여 빠른 응답과 대역폭 절약을 실현합니다.

```
첫 번째 요청: 클라이언트 → 프록시 → 원본 서버 (느림)
두 번째 요청: 클라이언트 → 프록시 (캐시) (빠름)
```

#### 3. 접근 제어
특정 웹사이트나 콘텐츠에 대한 접근을 차단하거나 허용합니다.
- 기업: 업무와 무관한 사이트 차단
- 학교: 유해 콘텐츠 필터링

#### 4. 로깅 및 모니터링
모든 인터넷 트래픽을 기록하고 분석합니다.

### 프록시의 종류

#### 1. HTTP 프록시
- 웹 트래픽(HTTP/HTTPS)만 처리
- 웹 브라우저에서 가장 많이 사용

#### 2. SOCKS 프록시
- 모든 종류의 트래픽 처리 가능 (HTTP, FTP, SMTP 등)
- 더 범용적이지만 캐싱 기능 없음
- SOCKS5가 가장 널리 사용됨

#### 3. 투명 프록시 (Transparent Proxy)
- 클라이언트가 프록시 존재를 인지하지 못함
- 별도 설정 없이 자동으로 프록시를 통과
- ISP나 기업에서 캐싱/필터링 목적으로 사용

### 프록시 사용 사례

#### 기업 환경
```
직원 PC → 기업 프록시 서버 → 인터넷
         (접근 제어, 로깅, 캐싱)
```
- 보안 정책 적용
- 인터넷 사용 내역 모니터링
- 대역폭 최적화

#### 개인 사용
- VPN과 유사한 우회 접속
- 지역 제한 콘텐츠 접근
- 개인정보 보호

---

## 리버스 프록시 (Reverse Proxy)

### 개념
리버스 프록시는 서버 앞단에 위치하여 클라이언트의 요청을 받아 내부 서버로 전달하는 중개 서버입니다. 프록시가 클라이언트를 대신한다면, 리버스 프록시는 서버를 대신합니다. 클라이언트는 리버스 프록시와 통신하는지 실제 서버와 통신하는지 알지 못합니다.

### 동작 구조
```
클라이언트 → 리버스 프록시 → 백엔드 서버 1
                    ├────────→ 백엔드 서버 2
                    └────────→ 백엔드 서버 3
```

### 상세 동작 과정
1. 클라이언트가 example.com으로 요청 전송
2. DNS는 리버스 프록시의 IP 주소를 반환
3. 리버스 프록시가 요청을 받아 적절한 백엔드 서버로 전달
4. 백엔드 서버의 응답을 받아 클라이언트에게 전달

### 리버스 프록시의 주요 기능

#### 1. 로드 밸런싱 (Load Balancing)
여러 서버에 트래픽을 분산하여 서버 부하를 균등하게 배분합니다.

```
클라이언트 요청 (1000개)
        ↓
  리버스 프록시
   ↙    ↓    ↘
서버1  서버2  서버3
(333)  (333)  (334)
```

**로드 밸런싱 알고리즘:**
- **Round Robin**: 순차적으로 분배
- **Least Connections**: 연결 수가 가장 적은 서버에 분배
- **IP Hash**: 클라이언트 IP 기반으로 특정 서버에 고정
- **Weighted**: 서버 성능에 따라 가중치를 두고 분배

#### 2. SSL/TLS 종료 (SSL Termination)
HTTPS 암호화/복호화를 리버스 프록시에서 처리하여 백엔드 서버의 부담을 줄입니다.

```
클라이언트 ←[HTTPS]→ 리버스 프록시 ←[HTTP]→ 백엔드 서버
          (암호화)                    (평문)
```

#### 3. 캐싱
정적 콘텐츠(이미지, CSS, JS)를 캐싱하여 서버 부하를 줄이고 응답 속도를 향상시킵니다.

#### 4. 보안 강화
- 실제 서버의 IP 주소와 구조를 숨김
- DDoS 공격 방어
- 웹 애플리케이션 방화벽(WAF) 기능 제공

#### 5. 압축
응답 데이터를 압축하여 전송량을 줄이고 속도를 향상시킵니다.

### 리버스 프록시 사용 사례

#### 1. 마이크로서비스 아키텍처
```
클라이언트 요청
      ↓
리버스 프록시 (Nginx)
      ↓
  API Gateway
   ↙  ↓  ↘
인증   주문   결제
서비스 서비스 서비스
```

#### 2. 웹 서버 앞단
```
인터넷 → Nginx (리버스 프록시) → Apache/Node.js/Django
       (정적 파일 캐싱)           (동적 콘텐츠 처리)
```

#### 3. CDN (Content Delivery Network)
전 세계에 분산된 리버스 프록시 서버들이 콘텐츠를 캐싱하고 제공합니다.

---

## 프록시 vs 리버스 프록시

### 핵심 차이점

| 구분 | 프록시 (Forward Proxy) | 리버스 프록시 |
|------|------------------------|---------------|
| **위치** | 클라이언트 쪽 | 서버 쪽 |
| **보호 대상** | 클라이언트 | 서버 |
| **클라이언트 인지 여부** | 클라이언트가 프록시 존재를 알고 설정 | 클라이언트는 리버스 프록시인지 모름 |
| **주요 목적** | 익명성, 접근 제어, 캐싱 | 로드 밸런싱, 보안, 성능 향상 |
| **설정 주체** | 클라이언트가 프록시 설정 | 서버 관리자가 설정 |

### 시각적 비교
```
프록시:
[클라이언트] --요청--> [프록시] --요청--> [서버]
(클라이언트를 대신)

리버스 프록시:
[클라이언트] --요청--> [리버스 프록시] --요청--> [서버]
                    (서버를 대신)
```

---

## 대표적인 프록시/리버스 프록시 소프트웨어

### Nginx
- 가장 인기 있는 리버스 프록시/웹 서버
- 높은 성능과 낮은 메모리 사용
- 로드 밸런싱, SSL/TLS 지원

### Apache (mod_proxy)
- 전통적인 웹 서버이자 리버스 프록시
- 다양한 모듈 지원

### HAProxy
- 전문 로드 밸런서
- 높은 가용성과 성능
- Layer 4/Layer 7 로드 밸런싱

### Squid
- 전통적인 포워드 프록시
- 강력한 캐싱 기능

### Envoy
- 최신 프록시 솔루션
- 마이크로서비스와 서비스 메시에 특화

---

## Nginx 리버스 프록시 설정 예시

### 기본 리버스 프록시
```nginx
server {
    listen 80;
    server_name example.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### 로드 밸런싱
```nginx
upstream backend {
    server backend1.example.com;
    server backend2.example.com;
    server backend3.example.com;
}

server {
    listen 80;
    server_name example.com;

    location / {
        proxy_pass http://backend;
    }
}
```

### 경로 기반 라우팅
```nginx
server {
    listen 80;
    server_name example.com;

    location /api/ {
        proxy_pass http://api-server:8080;
    }

    location /images/ {
        proxy_pass http://image-server:9000;
    }

    location / {
        proxy_pass http://web-server:3000;
    }
}
```

---

## 프록시/리버스 프록시와 다른 기술의 관계

### 프록시 vs VPN
- **프록시**: 애플리케이션 레벨, 특정 프로그램만 적용
- **VPN**: 네트워크 레벨, 모든 트래픽 암호화

### 리버스 프록시 vs API Gateway
- **리버스 프록시**: 트래픽 라우팅, 로드 밸런싱에 집중
- **API Gateway**: 인증, 인가, Rate Limiting, API 변환 등 더 많은 기능

### 리버스 프록시 vs 로드 밸런서
- 현대에는 거의 같은 의미로 사용
- 리버스 프록시가 더 넓은 개념
- 로드 밸런서는 주로 트래픽 분산에 특화

---

## 실무 활용 팁

### 1. 프록시 체인
여러 프록시를 연결하여 보안성을 높일 수 있습니다.
```
클라이언트 → 프록시1 → 프록시2 → 목적지
```

### 2. 헬스 체크
리버스 프록시는 백엔드 서버의 상태를 주기적으로 확인하여 장애 서버를 자동으로 제외합니다.

### 3. Sticky Session
특정 클라이언트의 요청을 항상 같은 서버로 보내야 할 때 사용합니다.

### 4. 캐시 무효화
콘텐츠 업데이트 시 캐시를 적절히 무효화하는 전략이 필요합니다.

이러한 프록시 기술들은 현대 웹 아키텍처에서 필수적인 요소로, 성능, 보안, 확장성을 모두 향상시키는 핵심 역할을 담당합니다.
